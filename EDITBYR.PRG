Memvar getlist
Field Tglbyr,nobpb,Faktur,Nama,Kodbrg,Kodelgn,tglht,;
      mobil,qtt,harga,jumlah,muka,jmlht,jmlpt,giro,tunai,bank,tglpt
Function Editbyr()
LOCAL MGIRO,MGIRO1,MTGL,MTUNAI,MSISA,MTUNAI1,MBANK,mtglbyr,mno,lih,i,jaw
SET COLOR TO
 FOR I:=1 TO 25
     SCROLL(,,,,-1)
 NEXT
BUKABYR()

SET COLOR TO GR+/B,W/R
@1,1 PROMPT '1.KOREKSI PEMBAYARAN HUTANG PERUSAHAAN'
@1,COL()+1 PROMPT '2.KOREKSI PEMBAYARAN HUTANG LANGGANAN'
@2,35 PROMPT ' 3. KELUAR '
MENU TO LIH
IF LIH %3==0
   CLOSE ALL
   Return (nil)
ENDIF

BKBYR1(LIH)

IF LIH=1
   DO WHILE .T.
      SELE TRHT
      SET COLOR TO W/N,W/N
      MNO:=SPACE(8)
      @5,17 GET MNO PICT '@!'
      READ
      IF MNO=''
         SET COLOR TO
         CLOSE ALL
         CLEAR
         Return (nil)
      ENDIF

      IF !CARI(21,MNO)
         @21,0
         LOOP
      ELSE
         SELE PMSK
         SEEK TRHT->PMS
         @7,17 SAY NAMA

         SELE HUTANG
         SEEK MNO
         @6,17 SAY TGLHT
         @8,21 SAY JMLHT PICT '@e 999,999,999'
         EXIT
      ENDIF
   ENDDO
   SELE TRHT
   DO WHILE NOBPB=MNO .AND. .NOT. EOF()
      SET COLOR TO W/N,W/N
      SELE HUTANG
      @9,21 SAY JMLHT-(GIRO+TUNAI)+(TRHT->GIRO+TRHT->TUNAI);
                PICT '@e 999,999,999'

      SELE TRHT
      MTGLBYR:=TGLBYR
      MBANK:=BANK
      MGIRO:=GIRO
      MTUNAI:=TUNAI
      SET COLOR TO
      @10,5
      @11,5
      @12,5
      @13,5
      @14,5
      SET COLOR TO GR,W/N
      @10,5 SAY 'TGL BAYAR :'
      @11,5 SAY 'KETERANGAN:'
      @12,5 SAY 'NILAI GIRO :Rp.'
      @13,5 SAY 'NILAI TUNAI:Rp.'
      @14,5 SAY 'SISA UTANG :Rp.'
      @10,17 GET MTGLBYR
      @11,17 GET MBANK PICT '@!'
      @12,21 GET MGIRO PICT '@Z 999,999,999'
      @13,21 GET MTUNAI PICT '@Z 999,999,999'
      READ

      SELE HUTANG
      SEEK MNO
      REPLACE GIRO WITH GIRO-TRHT->GIRO,TUNAI WITH TUNAI-TRHT->TUNAI
      MSISA:=JMLHT-(GIRO+TUNAI)-(MTUNAI+MGIRO)
      @14,21 SAY MSISA PICT '@e 999,999,999'
      IF MSISA<=0
         REPLACE TGLBYR WITH MTGLBYR,GIRO WITH GIRO+MGIRO,;
                 TUNAI WITH TUNAI+MTUNAI,STATUS WITH 'LUNAS '
      ELSE
         REPLACE TGLBYR WITH MTGLBYR,GIRO WITH GIRO+MGIRO,;
                 TUNAI WITH TUNAI+MTUNAI,STATUS WITH 'KREDIT'
      ENDIF

      REPLACE PMSK->TOTALHT WITH PMSK->TOTALHT+(TRHT->GIRO+TRHT->TUNAI);
              -(MGIRO+MTUNAI)

      SELE TRHT
      REPLACE TGLBYR WITH MTGLBYR,BANK WITH MBANK,PMS WITH HUTANG->PMS,;
              GIRO WITH MGIRO,TUNAI WITH MTUNAI
      SET COLOR TO W/R,N*/G
      JAW=.Y.
      @21,3 SAY ' APAKAH ADA DATA LAGI [Y/N]?'GET JAW PICT 'Y'
      READ

      IF ! JAW
         SET COLOR TO
         CLOSE ALL
         CLEAR
         Return (nil)
      ENDIF
      SKIP
   ENDDO
  close all
  Return (nil)
ENDIF

*********************** PIUTANG ******************
DO WHILE .T.
   SELE TRPT
   SET COLOR TO W/N,W/N
   MNO:=0
   MTGL:=DATE()
   @5,17 GET MTGL
   @6,17 GET MNO PICT '@e 99999'
   READ

   IF MNO=0
      SET COLOR TO
      CLOSE ALL
      CLEAR
      Return (nil)
   ENDIF

   SEEK MTGL
   DO WHILE MNO<>FAKTUR .and. .not. eof() .AND. MTGL=TGLBYR
      SKIP
   ENDDO
   IF MNO<>FAKTUR
      KOMENTAR(21,' NOMOR TIDAK DITEMUKAN, GANTI NOMOR LAIN ...... ')
      @21,3
      LOOP
   ENDIF

   SELE PIUTANG
   SEEK TRPT->TGLPT
   DO WHILE .NOT. EOF() .AND. MNO<>FAKTUR .AND. TRPT->TGLPT=TGLPT
      SKIP
   ENDDO
   IF MNO<>FAKTUR
      KOMENTAR(21,' DATA PIUTANG TIDAK DITEMUKAN, GANTI NOMOR LAIN ... ')
      @21,0
      LOOP
   ENDIF

   SELE LGN
   SEEK PIUTANG->KODELGN
   @7,17 SAY NAMA

   SELE PIUTANG
   @8,21 SAY JMLPT PICT '@e 999,999,999'
   @9,21 SAY JMLPT-(GIRO+TUNAI)+(TRPT->GIRO+TRPT->TUNAI) PICT '@e 999,999,999'
   EXIT
ENDDO

SELE TRPT
MBANK:=BANK
MGIRO:=GIRO
MTUNAI:=TUNAI
MGIRO1:=GIRO
MTUNAI1:=TUNAI

@10,17 SAY TGLPT
@11,17 GET MBANK PICT '@!'
@12,21 GET MGIRO PICT '@Z 999,999,999'
@13,21 GET MTUNAI PICT '@Z 999,999,999'
READ

SELE PIUTANG
 REPLACE GIRO WITH GIRO-TRPT->GIRO,TUNAI WITH TUNAI-TRPT->TUNAI
 MSISA=JMLPT-(GIRO+TUNAI)-(MTUNAI+MGIRO)
@14,21 SAY MSISA PICT '@e 999,999,999'
IF MSISA<=0
   REPLACE GIRO WITH GIRO+MGIRO,TUNAI WITH TUNAI+MTUNAI
   REPLACE STATUS WITH 'LUNAS '
ELSE
   REPLACE GIRO WITH GIRO+MGIRO,TUNAI WITH TUNAI+MTUNAI
   REPLACE STATUS WITH 'KREDIT'
ENDIF

REPLACE LGN->TOTALUT WITH LGN->TOTALUT+((MGIRO1+MTUNAI1)-(MGIRO+MTUNAI))

SELE TRPT
REPLACE BANK WITH MBANK,GIRO WITH MGIRO,TUNAI WITH MTUNAI
dbcommitall()

SET COLOR TO
CLOSE ALL
CLEAR
Return (nil)
